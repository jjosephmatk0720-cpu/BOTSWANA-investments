<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Jubilee Fortunes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 flex items-center justify-center min-h-screen p-6">

    <div class="w-full max-w-sm bg-slate-900 border border-white/10 p-10 rounded-[2.5rem] shadow-2xl">
        <div class="text-center mb-10">
            <h1 class="text-white font-black italic uppercase tracking-tighter text-2xl">Jubilee<span class="text-amber-500">Access</span></h1>
            <p class="text-slate-500 text-[9px] font-black uppercase tracking-widest mt-2">Secure Authentication</p>
        </div>

        <form id="login-form" class="space-y-4">
            <input type="email" id="email" placeholder="Email Address" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl text-white outline-none focus:border-amber-500 transition" required>
            <input type="password" id="pass" placeholder="Password" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl text-white outline-none focus:border-amber-500 transition" required>
            
            <button type="submit" class="w-full bg-amber-500 text-slate-900 py-4 rounded-2xl font-black uppercase text-xs tracking-widest mt-4 hover:bg-amber-400 transition">Login / Register</button>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDtvz0p0ID5HnB8DVdpWVJ4mCqYM_7M8n0",
            authDomain: "botswana-c92b4.firebaseapp.com",
            projectId: "botswana-c92b4",
            storageBucket: "botswana-c92b4.firebasestorage.app",
            messagingSenderId: "644341145732",
            appId: "1:644341145732:web:653352d30c8ff1efdd62d1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById('login-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;

            try {
                // Try to login
                const userCred = await signInWithEmailAndPassword(auth, email, pass);
                window.location.href = "profile.html";
            } catch (err) {
                // If user doesn't exist, create account
                if (err.code === 'auth/user-not-found' || err.code === 'auth/invalid-credential') {
                    try {
                        const newCred = await createUserWithEmailAndPassword(auth, email, pass);
                        const user = newCred.user;
                        // Initialize User Balance in Firestore
                        await setDoc(doc(db, "users", user.uid), {
                            email: email,
                            balance: 0,
                            activePlan: "None",
                            joined: new Date()
                        });
                        alert("Account Created Successfully!");
                        window.location.href = "profile.html";
                    } catch (createErr) {
                        alert("Error creating account: " + createErr.message);
                    }
                } else {
                    alert("Login Error: " + err.message);
                }
            }
        };
    </script>
</body>
</html>
