<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Jubilee Fortunes Investments 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; overflow-x: hidden; }
        .glass-card { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
        .gold-grad { background: linear-gradient(135deg, #fbbf24 0%, #b45309 100%); }
        .jubilee-gold { color: #fbbf24; }
        .popup-visible { transform: translateY(0) !important; opacity: 1 !important; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto mb-10 flex flex-col md:flex-row justify-between items-center bg-white/5 border border-white/10 p-6 rounded-[2.5rem]">
        <div>
            <p class="text-[9px] font-black uppercase tracking-[0.3em] text-slate-500 mb-1">Global Managed Assets</p>
            <h2 class="text-2xl font-black italic text-white">Total Invested: <span class="jubilee-gold">P5,000,000.00+</span></h2>
        </div>
        <div class="mt-4 md:mt-0">
            <p class="text-[9px] font-black uppercase text-green-500 bg-green-500/10 px-4 py-2 rounded-full border border-green-500/20 tracking-widest">● System Status: Optimal 2025</p>
        </div>
    </div>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-6">
            <div class="gold-grad p-10 rounded-[3rem] shadow-2xl shadow-amber-500/10 text-slate-950 relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-2">Your Smart Balance</p>
                    <h2 id="balance-display" class="text-5xl font-black tracking-tighter mb-10">P0.00</h2>
                    <div class="flex gap-2">
                        <button onclick="window.location.href='deposit.html'" class="flex-1 bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:scale-105 transition">Deposit</button>
                        <button onclick="openW()" class="flex-1 bg-black/10 border border-black/10 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-black/20 transition">Withdraw</button>
                    </div>
                </div>
                <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
            </div>

            <div class="glass-card p-8 rounded-[2.5rem]">
                <h3 class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-4">Live Performance</h3>
                <div class="flex justify-between items-end">
                    <p id="profit-display" class="text-3xl font-black text-green-400">P0.0000</p>
                    <span class="text-[9px] font-bold text-slate-500 uppercase">Daily Interest</span>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div class="glass-card p-10 rounded-[3rem] min-h-[500px]">
                <div class="flex justify-between items-center mb-10">
                    <h3 class="text-xs font-black uppercase tracking-[0.2em] jubilee-gold">2025 History Analysis</h3>
                    <div class="h-1 flex-1 mx-6 border-b border-white/5"></div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-white/5">
                                <th class="pb-4">Date</th>
                                <th class="pb-4">Description</th>
                                <th class="pb-4">Amount</th>
                                <th class="pb-4">Status</th>
                            </tr>
                        </thead>
                        <tbody id="history-table" class="text-sm font-bold">
                            </tbody>
                    </table>
                </div>
                
                <div id="empty-state" class="hidden text-center py-24">
                    <p class="text-slate-600 italic text-sm">No transaction history found. Start your first P60 investment.</p>
                </div>
            </div>
        </div>
    </main>

    <div id="w-modal" class="fixed inset-0 bg-slate-950/95 z-[999] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-white/10 w-full max-w-md rounded-[3rem] p-8 shadow-2xl relative">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-black uppercase italic">Withdraw <span class="jubilee-gold">Funds</span></h2>
                <button onclick="closeW()" class="text-slate-500 hover:text-white transition">✕</button>
            </div>

            <div class="space-y-6">
                <div class="flex gap-2 bg-white/5 p-1 rounded-xl">
                    <button onclick="setM('orange')" id="mo" class="flex-1 py-3 rounded-lg text-[9px] font-black bg-gold text-slate-900 transition">ORANGE MONEY</button>
                    <button onclick="setM('crypto')" id="mc" class="flex-1 py-3 rounded-lg text-[9px] font-black text-slate-400 transition">USDT (TRC20)</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label id="detail-label" class="text-[8px] font-black text-slate-500 uppercase ml-2 mb-1 block">Orange Number</label>
                        <input type="text" id="w-detail" placeholder="72 XXX XXX" class="w-full bg-white/5 p-4 rounded-2xl border border-white/10 outline-none text-white font-bold focus:border-amber-400">
                    </div>
                    <div>
                        <label class="text-[8px] font-black text-slate-500 uppercase ml-2 mb-1 block">Amount (Min P50)</label>
                        <input type="number" id="w-amt" placeholder="0.00" class="w-full bg-white/5 p-4 rounded-2xl border border-white/10 outline-none text-white font-black text-xl focus:border-amber-400">
                    </div>
                </div>

                <button onclick="subW()" class="w-full bg-white text-slate-900 py-5 rounded-3xl font-black uppercase text-[10px] tracking-widest hover:bg-gold transition shadow-xl">
                    Submit Request
                </button>
            </div>
        </div>
    </div>

    <div id="act-pop" class="fixed bottom-6 left-6 z-[100] transform translate-y-20 opacity-0 transition-all duration-700 bg-slate-900/90 backdrop-blur-xl p-4 rounded-2xl border border-white/10 min-w-[280px] flex items-center gap-4">
        <div class="w-2 h-2 bg-gold rounded-full animate-ping"></div>
        <div>
            <p id="act-u" class="text-[9px] font-black text-white uppercase tracking-tighter"></p>
            <p id="act-a" class="text-[10px] font-bold text-slate-400"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBmZC9gaj68vd-tWHqgf9H0pYZBvVHhnPE", authDomain: "remoteworkingacess.firebaseapp.com", projectId: "remoteworkingacess", storageBucket: "remoteworkingacess.firebasestorage.app", messagingSenderId: "953179052891", appId: "1:953179052891:web:8126924e32e9fb62f4987e" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "login.html";
            else {
                // Real-time Balance & Profit Listener
                onSnapshot(doc(db, "users", user.uid), (snap) => {
                    if(snap.exists()) {
                        const data = snap.data();
                        document.getElementById('balance-display').innerText = `P${(data.balance || 0).toFixed(2)}`;
                        document.getElementById('profit-display').innerText = `P${(data.accruedProfit || 0).toFixed(4)}`;
                    }
                });

                // History Table Listener
                const historyTable = document.getElementById('history-table');
                const emptyState = document.getElementById('empty-state');
                const q = query(collection(db, "users", user.uid, "transactions"), orderBy("time", "desc"));
                
                onSnapshot(q, (snap) => {
                    if (snap.empty) {
                        emptyState.classList.remove('hidden');
                        historyTable.innerHTML = "";
                    } else {
                        emptyState.classList.add('hidden');
                        let html = "";
                        snap.forEach(doc => {
                            const tr = doc.data();
                            const date = tr.time ? new Date(tr.time.seconds * 1000).toLocaleDateString() : 'Pending';
                            html += `<tr class="border-b border-white/5 hover:bg-white/5 transition">
                                <td class="py-6 text-slate-500 text-[10px]">${date}</td>
                                <td class="py-6 uppercase text-[10px] tracking-tighter">${tr.type}</td>
                                <td class="py-6 jubilee-gold">P${tr.amount.toFixed(2)}</td>
                                <td class="py-6"><span class="text-[8px] border border-white/10 px-3 py-1 rounded-full uppercase">${tr.status}</span></td>
                            </tr>`;
                        });
                        historyTable.innerHTML = html;
                    }
                });
            }
        });

        // Withdrawal UI Logic (Global Scope)
        let curM = 'orange';
        window.openW = () => { document.getElementById('w-modal').classList.remove('hidden'); document.body.style.overflow='hidden'; };
        window.closeW = () => { document.getElementById('w-modal').classList.add('hidden'); document.body.style.overflow='auto'; };
        
        window.setM = (m) => {
            curM = m;
            document.getElementById('detail-label').innerText = m === 'orange' ? "Orange Number" : "TRC20 Network Address";
            document.getElementById('w-detail').placeholder = m === 'orange' ? "72 XXX XXX" : "TXXXXXXXXXXXXXXXXXXXX...";
            document.getElementById('mo').className = m === 'orange' ? "flex-1 py-3 rounded-lg text-[9px] font-black bg-gold text-slate-900" : "flex-1 py-3 text-slate-400";
            document.getElementById('mc').className = m === 'crypto' ? "flex-1 py-3 rounded-lg text-[9px] font-black bg-gold text-slate-900" : "flex-1 py-3 text-slate-400";
        };

        window.subW = () => {
            const a = document.getElementById('w-amt').value;
            const d = document.getElementById('w-detail').value;
            if(a < 50) return alert("Min withdrawal is P50");
            if(curM === 'crypto' && !d.startsWith('T')) return alert("Invalid TRC20 Address");
            alert(`P${a} withdrawal request submitted to Jubilee Admin.`); closeW();
        };

        // RANDOM LIVE ACTIVITY LOOP
        const investors = ["Thabo", "Sarah", "Mpho", "Neo", "Kabelo", "Lesedi", "Dumisani"];
        const actions = ["just withdrew", "activated Smart Start", "received daily profit of", "reinvested"];
        setInterval(() => {
            const p = document.getElementById('act-pop');
            document.getElementById('act-u').innerText = investors[Math.floor(Math.random()*investors.length)] + " (Inv#" + Math.floor(1000+Math.random()*9000)+")";
            document.getElementById('act-a').innerHTML = actions[Math.floor(Math.random()*actions.length)] + " <span class='jubilee-gold'>P" + (Math.random()*400+50).toFixed(2) + "</span>";
            p.classList.add('popup-visible');
            setTimeout(() => p.classList.remove('popup-visible'), 4000);
        }, 12000);
    </script>
</body>
</html>